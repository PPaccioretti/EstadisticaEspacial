[
  {
    "objectID": "Espacial_IG2022.html",
    "href": "Espacial_IG2022.html",
    "title": "Modelos Espaciales",
    "section": "",
    "text": "Mostrar en una nueva pestaña"
  },
  {
    "objectID": "Ej01.html",
    "href": "Ej01.html",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "",
    "text": "La generación de datos a partir de imágenes satelitales, constituyen una fuente valiosa de información, pudiéndose construir incluso series históricas de imagen de un sitio. En bioestadística este tipo de datos se usa para monitorear ecosistemas, realizar pronósticos climáticos y predecir cosechas, entre otros.\nEn este caso mostramos la implementación de un análisis exploratorio de datos para caracterizar la variable toneladas de caña por hectárea. Luego estudiaremos el uso de modelos de regresión lineal para estimar rendimientos de caña de azúcar a partir de índices de vegetación elaborados con información proveniente de sensores remotos."
  },
  {
    "objectID": "Ej01.html#running-code",
    "href": "Ej01.html#running-code",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Running Code",
    "text": "Running Code\nWhen you click the Render button a document will be generated that includes both content and the output of embedded code. You can embed code like this:\n\n1 + 1\n\n## [1] 2\n\n\nYou can add options to executable code like this\n\n\n## [1] 4\n\n\nThe echo: false option disables the printing of code (only output is displayed)."
  },
  {
    "objectID": "slides.html",
    "href": "slides.html",
    "title": "Modelos Espaciales",
    "section": "",
    "text": "CONAE spring school 2022\nMarius Appel\nSept. 27, 2022\n\n\n\nData availability (e.g. Sentinel-2) in the cloud\nMethod availability (e.g. in R, > 18k CRAN packages)\nWho wants to download > 100 GB from data portals?\n\n\n\n\nObjective: Show how you can analyze satellite image collections in the cloud with R\n\nIntroduction:\n\nCloud computing\nSatellite imagery in the cloud\nCloud-native geospatial echnologies\nR ecosystem\n\nLive examples\n\nCreating composite images\nComplex time series analysis\nExtraction from data cubes\n\nDiscussion\n\nAll materials are available on GitHub: https://github.com/appelmar/CONAE_2022."
  },
  {
    "objectID": "slides.html#in-the-cloud",
    "href": "slides.html#in-the-cloud",
    "title": "Modelos Espaciales",
    "section": "“… in the cloud”",
    "text": "“… in the cloud”\n\n\nServices:\n\nGoogle Earth Engine (GEE)\nSentinel Hub\nopenEO backends\n…\n\n\nInfrastructure providers:\n\nAmazon web services (AWS)\nGoogle Cloud Platform\nMicrosoft Azure\n…\n\n\n\nSomewhere in between: Microsoft Planetary Computer\n\n\nIn this tutorial, we will use a custom machine on AWS to analyze satellite image collections in the cloud."
  },
  {
    "objectID": "slides.html#cloud-infrastructure-aws",
    "href": "slides.html#cloud-infrastructure-aws",
    "title": "Modelos Espaciales",
    "section": "Cloud infrastructure (AWS)",
    "text": "Cloud infrastructure (AWS)\n\nLots of separate data centers with large clusters\nIn total: > 25 regions and > 80 availability zones\nBasic service to run (virtual) machines: EC2 (Amazon Elastic Compute Cloud)"
  },
  {
    "objectID": "slides.html#running-a-machine-in-the-cloud-aws",
    "href": "slides.html#running-a-machine-in-the-cloud-aws",
    "title": "Modelos Espaciales",
    "section": "Running a machine in the cloud (AWS)",
    "text": "Running a machine in the cloud (AWS)\n\nSelect a region and machine instance type, based on costs, hardware, and OS\nCreate a key pair for accessing the machine over SSH\nClick “Launch instance” and follow instructions\nConnect via SSH and install software (PROJ, GDAL, R, RStudioServer1, R packages, …)\n\nNotice that security considerations (e.g. by using IAM roles, multi-factor authorization) are NOT part of this tutorial.\nYou need to add a security rule to allow public / protected access to RStudioServer."
  },
  {
    "objectID": "slides.html#aws-management-console",
    "href": "slides.html#aws-management-console",
    "title": "Modelos Espaciales",
    "section": "AWS Management Console",
    "text": "AWS Management Console"
  },
  {
    "objectID": "slides.html#example-platforms-and-available-data",
    "href": "slides.html#example-platforms-and-available-data",
    "title": "Modelos Espaciales",
    "section": "Example platforms and available data",
    "text": "Example platforms and available data\n\n\n\n\nProvider\nData\n\n\n\n\nAmazon web services (AWS)\nSentinel, Landsat, ERA 5, OSM, CMIP 6, and more, see here\n\n\nGoogle Cloud Platform\nLandsat, Sentinel, access to GEE data\n\n\nCopernicus DIASes\nSentinel + more (see here)\n\n\nMicrosoft Planetary Computer\nSentinel, Landsat, MODIS and more, see here"
  },
  {
    "objectID": "slides.html#object-storage-s3",
    "href": "slides.html#object-storage-s3",
    "title": "Modelos Espaciales",
    "section": "Object Storage: S3",
    "text": "Object Storage: S3\nEC2 machines have local storage (EBS) but big data archives use highly scalable object storage.\nS3 elements:\n\nBucket: container for objects that are stored in a specific AWS region\nObjects: Individual files and corresponding metadata within a bucket, identified by a unique key\nKey: Filenames / Path or similar; unique within a bucket\n\nPricing (storage, transfer, requests):\n\nBucket owner pays by default\nFor requester pays buckets, transfer and requests are paid by users"
  },
  {
    "objectID": "slides.html#s3-examples",
    "href": "slides.html#s3-examples",
    "title": "Modelos Espaciales",
    "section": "S3 examples",
    "text": "S3 examples\n\nBuckets:\n\nhttps://registry.opendata.aws/sentinel-2\nhttps://registry.opendata.aws/usgs-landsat/\n\nObject:\n\nhttps://sentinel-cogs.s3.us-west-2.amazonaws.com/sentinel-s2-l2a-cogs/20/J/ML/2022/3/S2B_20JML_20220330_0_L2A/B04.tif"
  },
  {
    "objectID": "slides.html#data-access",
    "href": "slides.html#data-access",
    "title": "Modelos Espaciales",
    "section": "Data access",
    "text": "Data access\n\nBuckets are not a drive on your machine\nData access over HTTP requests (PUT, GET, DELETE, …)\n\n\nChallenges\n\nHow to find images by location, time, and other criteria?\nHow to efficiently read image data from S3 without copying images to our machine storage first?"
  },
  {
    "objectID": "slides.html#stac-overview",
    "href": "slides.html#stac-overview",
    "title": "Modelos Espaciales",
    "section": "STAC overview",
    "text": "STAC overview\n\nStandardized JSON-based language for describing catalogs of spatiotemporal data (imagery, point clouds, SAR)\nExtensible (available extensions include EO, Data Cubes, Point Clouds, and more)\n1.0.0 release available since May 2021\nGrowing ecosystem"
  },
  {
    "objectID": "slides.html#stac-specification",
    "href": "slides.html#stac-specification",
    "title": "Modelos Espaciales",
    "section": "STAC specification",
    "text": "STAC specification\n\nItems are inseparable objects of data (assets) and metadata (e.g. a single satellite image)\nCatalogs can be nested\nCollections extend catalogs and can be used to group items and their metadata (e.g. license)"
  },
  {
    "objectID": "slides.html#stac-api",
    "href": "slides.html#stac-api",
    "title": "Modelos Espaciales",
    "section": "STAC API",
    "text": "STAC API\nStatic STAC catalogs\n\nTypically set of linked JSON files, starting with a catalog.json\nCatalog JSON contains links to collections, nested catalogs, or items\nItems contain assets (links to files) and metadata\nProblem: All items must be processed for searching\nExample: https://meeo-s5p.s3.amazonaws.com/catalog.json\n\nSTAC API\n\nWeb-service for dynamic search of STAC items by area of interest, datetime, and other metadata\nCompliant with OGC API - Features standard\n\nSTAC Index\n\nA good starting point to find available STAC collections and API services: https://stacindex.org"
  },
  {
    "objectID": "slides.html#cloud-optimized-geotiff-cog",
    "href": "slides.html#cloud-optimized-geotiff-cog",
    "title": "Modelos Espaciales",
    "section": "Cloud-optimized GeoTIFF (COG)",
    "text": "Cloud-optimized GeoTIFF (COG)\nImage file formats must be cloud-friendly to reduce transfer times and costs associated with transfer and requests\n\n\n\nCOG = Normal tiled GeoTIFF files whose content follows a specific order of data and metadata (see full spec here)\nsupport compression\nsupport efficient HTTP range requests, i.e. partial reading of images (blocks, and overviews) over cloud storage\nmay contain overview images (image pyramids)\n\n\n\n\n\nGDAL can efficiently read and write COGs, and access object storage in the cloud with virtual file systems"
  },
  {
    "objectID": "slides.html#satellite-image-collections",
    "href": "slides.html#satellite-image-collections",
    "title": "Modelos Espaciales",
    "section": "Satellite image collections",
    "text": "Satellite image collections\nImages spatially overlap, have different coordinate reference systems, have different pixel sizes depending on spectral bands, yield irregular time series for larger areas"
  },
  {
    "objectID": "slides.html#what-is-a-data-cube",
    "href": "slides.html#what-is-a-data-cube",
    "title": "Modelos Espaciales",
    "section": "What is a data cube?",
    "text": "What is a data cube?\nHere: A four-dimensional (space, time, variable / band) regular raster data cube\n\ncollect all observations in one object\n\\(b \\times t \\times y \\times x \\rightarrow\\) real value\nsingle CRS, cells have constant temporal duration, and spatial size"
  },
  {
    "objectID": "slides.html#data-cube-creation-is-lossy",
    "href": "slides.html#data-cube-creation-is-lossy",
    "title": "Modelos Espaciales",
    "section": "Data Cube creation is lossy",
    "text": "Data Cube creation is lossy\nImportant: There is no single correct data cube!"
  },
  {
    "objectID": "slides.html#r-packages",
    "href": "slides.html#r-packages",
    "title": "Modelos Espaciales",
    "section": "R packages",
    "text": "R packages\n\nraster / terrastarsgdalcubessitsothers\n\n\n\nGeneral packages for raster data analysis\nterra [@terra] is a newer (faster) package that replaces raster [@raster]\n\nSupport two- or three-dimensional rasters\nInclude lots of analysis tools\n\n\n\n\nFlexible package for spatiotemporal arrays / data cubes with arbitrary number of dimensions [@stars]\nSupports raster and vector data cubes\n\n\n\n\n\n\n\n\n\n\n\nImagery from https://r-spatial.github.io/stars\n\n\n\n\nCreation and processing of four-dimensional (space, time, variable) data cubes from irregular image collections [@gdalcubes]\nParallel chunk-wise processing\nDocumentation available at https://gdalcubes.github.io/\n\n\n\n\nGeneric package for satellite image time series analysis [@sits]\nBuilds on top of previous packages\nIncludes sophisticated methods with a focus on time series classification\nDocumentation: https://e-sensing.github.io/sitsbook/\n\n\n\n\n\n\n\nImagery from https://github.com/e-sensing/sits\n\n\n\n\nrstac [ @rstac]: Query images from STAC-API services\nsp [@sp]: replaced by sf and stars\nopeneo [@openeo]: Connect to and analyse data at openEO backends\n\n\n\n\n\nThis tutorial focuses on the packages rstac and gdalcubes."
  },
  {
    "objectID": "slides.html#discussion-1",
    "href": "slides.html#discussion-1",
    "title": "Modelos Espaciales",
    "section": "Discussion",
    "text": "Discussion\n\n\n\nAdvantages\n\nAccess to huge data archives\nFlexibility: You can do whatever you can do on your local machine\nPowerful machines available\nOpen source software only\n\n\n\n\nDisadvantages\n\nNot free\nGEE and others can be easier to use (some are free)\nYour institution’s computing center might have more computing resources (for free)\nSetup and familiarization needed\nDepends on the existence of STAC-API services and imagery as COGs!\n\n\n\n\n→ Which tools / platforms / environments are most efficient to use highly depends on factors like data volume, computational effort, data & method availability, effort needed to familiarization and reimplementation, and others."
  },
  {
    "objectID": "slides.html#summary",
    "href": "slides.html#summary",
    "title": "Modelos Espaciales",
    "section": "Summary",
    "text": "Summary\n\nCloud-computing platforms contain lots of satellite data\nCloud storage differs from local storage\nTechnology and tools:\n\nSTAC (and STAC API!) for efficient and standardized search of spatiotemporal EO data\nCOGs allow efficiently reading parts of imagery, potentially on lower resolution\nGDAL has everything for efficient data access on cloud storage\ngdalcubes makes the creation and processing of data cubes from satellite image collections in R easier"
  },
  {
    "objectID": "slides.html#references",
    "href": "slides.html#references",
    "title": "Modelos Espaciales",
    "section": "References",
    "text": "References"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Estadística para datos espaciales",
    "section": "",
    "text": "En la última década la obtención automática y disponibilidad de datos georreferenciados en dominios espaciales continuos fue en aumento. La infraestructura de datos espaciales aumenta en diversidad, tamaño y calidad. Para modelar la variabilidad de una variable de interés (ya sea continua o discreta) resultante de la observación de un proceso espacial es necesario contemplar la correlación espacial en los datos ya que al tratar los datos como independientes se producen malas estimaciones de errores estándares y por tanto errores en las conclusiones asociadas a las hipótesis de los parámetros de interés.\nEn este tutorial se modelan datos geoestadísticos de una variable respuesta en función de otras covariables potencialmente explicativas desde dos enfoques metodológicos para al estimación y la inferencia: los modelos lineales mixtos con estimación frecuentistas y los modelos jerárquicos bayesianos."
  },
  {
    "objectID": "index.html#contents",
    "href": "index.html#contents",
    "title": "Estadistica espacial",
    "section": "Contents",
    "text": "Contents\n\nIntroduction\n\nThe cloud\nSatellite imagery on cloud platforms\nCloud-native technologies: STAC, COGs, data cubes\nR ecosystem for analyzing satellite imagery\nThe gdalcubes R package\n\nHands-on examples\n\nImage compositing\nTime series analysis\nExtraction\n\nDiscussion"
  },
  {
    "objectID": "index.html#contenidos",
    "href": "index.html#contenidos",
    "title": "Estadística para datos espaciales",
    "section": "Contenidos",
    "text": "Contenidos\n\nModelos Mixtos para datos con correlación espacial\n\nModelos Lineales Mixtos (MLM)\nModelos Jerárquicos Bayesianos (MJB)\n\nEjemplos de aplicación\n\nMLM-Regresión Lineal Simple para variable normal con errores correlacionados espacialmente: rendimiento en función de índices satelitales de cobertura de vegetación\nMJB-Regresión Lineal Múltiple para variable de conteo con efecto aleatorio espacial: Casos de COVID positivo en función de variables socioeconómicas en un territorio\nMJB-Relación Lineal múltiple de dos variables con covariabilidad espacial conjunta. Virosis en cultivos realizados el mismo año en función del clima."
  },
  {
    "objectID": "slides.html#motivation",
    "href": "slides.html#motivation",
    "title": "Modelos Espaciales",
    "section": "Motivation",
    "text": "Motivation\n\nData availability (e.g. Sentinel-2) in the cloud\nMethod availability (e.g. in R, > 18k CRAN packages)\nWho wants to download > 100 GB from data portals?"
  },
  {
    "objectID": "slides.html#tutorial-overview",
    "href": "slides.html#tutorial-overview",
    "title": "Modelos Espaciales",
    "section": "Tutorial overview",
    "text": "Tutorial overview\nObjective: Show how you can analyze satellite image collections in the cloud with R\n\nIntroduction:\n\nCloud computing\nSatellite imagery in the cloud\nCloud-native geospatial echnologies\nR ecosystem\n\nLive examples\n\nCreating composite images\nComplex time series analysis\nExtraction from data cubes\n\nDiscussion\n\nAll materials are available on GitHub: https://github.com/appelmar/CONAE_2022."
  },
  {
    "objectID": "slides.html#análisis-de-datos.-paradigmas",
    "href": "slides.html#análisis-de-datos.-paradigmas",
    "title": "Modelos Espaciales",
    "section": "Análisis de datos. Paradigmas",
    "text": "Análisis de datos. Paradigmas\n\n\nAnalítico\n\nFundamentación matemática de los procedimientos estadísticos\nResultados muchas veces exactos\nExpresiones cerradas para medidas de incertidumbre, al menos asintóticas\nTeoremas de respaldo, necesidad de supuestos distribucionales\nModelos estadísticos\nClasificación y Predicción\n\n\n\n\nComputación intensiva\n\nSoluciones númericas\nResultados aproximados por procesos iterativos\nCapacidad de modelar situaciones más complejas con supuestos menos restrictivos\nAprendizajes automáticos\nMás exploratorios que inferenciales\nModelos o algoritmos explicativos\nClasificación y Predicción"
  },
  {
    "objectID": "slides.html#análisis-de-datos.-paradigmas-1",
    "href": "slides.html#análisis-de-datos.-paradigmas-1",
    "title": "Modelos Espaciales",
    "section": "Análisis de datos. Paradigmas",
    "text": "Análisis de datos. Paradigmas\nSomewhere in between: Microsoft Planetary Computer\n\n\nIn this tutorial, we will use a custom machine on AWS to analyze satellite image collections in the cloud."
  },
  {
    "objectID": "slides.html#sda",
    "href": "slides.html#sda",
    "title": "Modelos Espaciales",
    "section": "sda",
    "text": "sda\nObjective: Show how you can analyze satellite image collections in the cloud with R\n\nIntroduction:\n\nCloud computing\nSatellite imagery in the cloud\nCloud-native geospatial echnologies\nR ecosystem\n\nLive examples\n\nCreating composite images\nComplex time series analysis\nExtraction from data cubes\n\nDiscussion\n\nAll materials are available on GitHub: https://github.com/appelmar/CONAE_2022."
  },
  {
    "objectID": "slides.html#modelo-lineal-general",
    "href": "slides.html#modelo-lineal-general",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal General",
    "text": "Modelo Lineal General\n\\[Y = Valor\\ Esperado + Error\\]\n\\[Y = Modelo\\ de\\ Media + Modelo\\ de\\ Varianza\\ y \\ Covarianza\\]\nEn el Modelo de Media, la respuesta se relaciona linealmente con regresoras y/o variables de clasificación (Modelos de Regresión, Modelos de ANAVA)\nEl Modelo de varianzas y covarianzas se determina con supuestos distribucionales para los términos de error:\n\n\n\ni.i.d Normales\nno correlacionados\nvarianza constante\n\n\n\n\n\n\n\n\n\nHay alternativas para corregir la falta de cumplimiento de algunos de estos supuestos.\n\n\n\n\n\n\n\n\n\nEl cumplimiento de los supuestos no son necesarios para la estimación pero sí para la inferencia, esto significa que el valor-p puede no ser real en caso de incumplimiento de estos."
  },
  {
    "objectID": "slides.html#modelo-de-regresión-lineal",
    "href": "slides.html#modelo-de-regresión-lineal",
    "title": "Modelos Espaciales",
    "section": "Modelo de Regresión Lineal",
    "text": "Modelo de Regresión Lineal\n\\[Y_{ij} = \\beta_0 + \\beta_1 x_{ij}+\\varepsilon_{ij}\\]\n\\[\\varepsilon_{ij} \\sim N \\big(0, \\sigma^2 \\big) \\: \\: \\:\ncov(\\varepsilon_{ij}, \\varepsilon_{i'j'}) = 0 \\: \\forall ij \\neq i' j'\\]\nDonde:\n\n\\(Y_{ij}\\) es la observación en la \\(j-ésima\\) repetición de la \\(i-ésima\\) variable explicativa.\n\\(\\beta_0\\) es un término constante o intercepto\n\\(\\beta_1\\) es el efecto de la variable explicativa\n\\(x_{ij}\\) es el valor de la \\(j-ésima\\) repetición de la \\(i-ésima\\) variable explicativa.\n\\(\\varepsilon_{ij}\\) es un efecto aleatorio o término de error asociado a la observación \\(Y_{ij}\\)\n\n\n\n\n\n\n\nAlternativamente la covarianza entre los términos de error puede ser distinta de cero, por ejemplo covarianza positiva expresada como función de la distancia entre observaciones"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto",
    "href": "slides.html#modelo-lineal-mixto",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto",
    "text": "Modelo Lineal Mixto\nPermite estimar un modelo para respuestas normales sin que se cumpla el supuesto de independencia y/o de homogeneidad de varianzas\nLa respuesta se modela como función de variables explicativas de efectos fijos y de efectos aleatorios.\nLa correlación se puede abordar de dos formas:\n\nEspecificando correlaciones entre los términos de error\nIncorporando efectos aleatorios que inducen correlaciones entre los datos que comparten el mismo nivel del efecto\n\n\n\n\n\n\n\nLa correlación entre los errores se especifica como función de la distancia espacial entre las observaciones (por ej. correlación espacial exponencial o esférica como modelos para la caída de las correlaciones a medida que aumenta la distancia entre observaciones)"
  },
  {
    "objectID": "slides.html#modelo-lineal-generalizado.-componentes",
    "href": "slides.html#modelo-lineal-generalizado.-componentes",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Generalizado. Componentes",
    "text": "Modelo Lineal Generalizado. Componentes\n\nDistribución de las observaciones\n\nNo necesariamente normal, no asume homogeneidad de varianzas\n\nPredictor lineal\n\nCombinación lineal del efecto de las fuentes de variación más un intercepto\n\nFunción de enlace\n\nPermite ajustar un modelo lineal a la media de la respuesta. Cuando estimamos los parámetros del modelo lineal, lo hacemos en la escala de la función de enlace. Su inversa nos da el valor predicho en la escala de las observaciones"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto.-efectos-fijos-y-aleatorios-1",
    "href": "slides.html#modelo-lineal-mixto.-efectos-fijos-y-aleatorios-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto. Efectos Fijos y Aleatorios",
    "text": "Modelo Lineal Mixto. Efectos Fijos y Aleatorios\n\\(Y\\) es función de covariables/factores de efectos fijos (constante) y aleatorios\nFijo vs. Aleatorio: - niveles arbitrariamente determinados vs. muestra aleatoria de niveles (asociado a una distribución de probabilidad)\nFijo vs. Aleatorio: - contexto; mecanismos de colección; espacio de inferencia; estrategia de modelación. Cantidad de niveles, calidad de la estimación de componentes de varianza. Cómputo de covarianzas."
  },
  {
    "objectID": "slides.html#modelo-lineal-generalizado",
    "href": "slides.html#modelo-lineal-generalizado",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Generalizado",
    "text": "Modelo Lineal Generalizado\n\nLineal\n\nUna transformación de la media (valor esperado de la respuesta) se relaciona linealmente con las fuentes de variación reconocidas a priori\nPredictor lineal de una función de la esperanza o media de \\(Y\\), \\(E(Y)\\)\n\nGeneralizado\n\nLa componente aleatoria puede ser no-normal (distribución miembro de la familia exponencial como es el caso de Bernouille, Binomial y Poisson para modelar presencia/ausencia, proporciones y conteos respectivamente y el caso de distribuciones continuas: Normal, Gamma, Inversa Gaussiana)"
  },
  {
    "objectID": "slides.html#modelo-lineal-generalizado-mixto-glmm",
    "href": "slides.html#modelo-lineal-generalizado-mixto-glmm",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Generalizado Mixto (GLMM)",
    "text": "Modelo Lineal Generalizado Mixto (GLMM)\nNo necesariamente normal, no-homogeneidad y no independencia\nMLGM permite trabajar datos no normales (por ejemplo variables binarias y conteos) y correlaciones, a través de la incorporación de efectos aleatorios. Es un modelo Jerárquico"
  },
  {
    "objectID": "slides.html#modelo-bayesiano",
    "href": "slides.html#modelo-bayesiano",
    "title": "Modelos Espaciales",
    "section": "Modelo Bayesiano",
    "text": "Modelo Bayesiano\n\nRelacionan la variable dependiente con variables explicativas a través de parámetros desconocidos.\nLos parámetros se interpretan en término de probabilidades bayesianas; se supone una distribución “a priori” para cada parámetro y se deriva la distribución “a posteriori” de cada parámetro.\nLa media, moda o mediana de la distribución a posteriori se usa como proxy del parámetro.\nLas “a priori” son parte del modelo y una manera de expresar la distribución de probabilidad de los datos dados los parámetros.\nLos parámetros de las distribuciones “a priori” se llaman hiperparámetros.\n“a posteriori” = actualización de la “a priori” con los datos observados.\nPermite otorgar grado de creencia (intervalo de credibilidad)"
  },
  {
    "objectID": "slides.html#por-qué-jerárquico",
    "href": "slides.html#por-qué-jerárquico",
    "title": "Modelos Espaciales",
    "section": "¿Por qué Jerárquico?",
    "text": "¿Por qué Jerárquico?\nLos datos \\(Z\\) tienen una distribución condicional dado el proceso latente que los ha generado \\(Y\\), que a su vez tiene una distribución condicional a ciertos parámetros \\(\\theta\\) y \\(\\theta\\) tiene a su vez una distribución “a priori”.\n\n\n\n\n\n\n\nModelo para los datos\nModelo para el proceso\nModelo para los parámetros\n\\(\\left[ Z \\big\\vert Y, \\theta \\right]\\)\n\\(\\left[ Y \\big\\vert \\theta \\right]\\)\n\\(\\left[ \\theta \\right]\\)"
  },
  {
    "objectID": "slides.html#modelo-jerárquico-bayesiano",
    "href": "slides.html#modelo-jerárquico-bayesiano",
    "title": "Modelos Espaciales",
    "section": "Modelo Jerárquico Bayesiano",
    "text": "Modelo Jerárquico Bayesiano\n\nLos parámetros se interpretan en término de probabilidades bayesianas; se supone una distribución “a priori” para cada parámetro y se deriva la distribución “a posteriori” de cada parámetro.\nLa media, moda o mediana de la distribución a posteriori se usa como proxy del parámetro.\nLas “a priori” son parte del modelo y una manera de expresar la distribución de probabilidad de los datos dados los parámetros.\nLos parámetros de las distribuciones “a priori” se llaman hiperparámetros.\n“a posteriori” = actualización de la “a priori” con los datos observados.\nPermite otorgar grado de creencia (intervalo de credibilidad)"
  },
  {
    "objectID": "slides.html#modelo-gausiano-latente",
    "href": "slides.html#modelo-gausiano-latente",
    "title": "Modelos Espaciales",
    "section": "Modelo Gausiano Latente",
    "text": "Modelo Gausiano Latente\nEl predictor lineal contiene el intercepto, los efectos de las covariables y funciones desconocidas \\(f^{(k)}\\) que incluyen los efectos aleatorios:\n\\[\\eta_i = \\mu + \\sum_{j}{\\beta_j z_{ij}} + \\sum_{k}{f^{(k)}u_{ik}}\\]\nLos componentes del predictor lineal forman un campo latente \\(x=(\\eta, \\mu, \\beta, f)\\). Además de los parámetros de la verosimilitud, también habrá hiperparámetros \\(\\theta\\). En un MLG, todos los componentes del predictor lineal deben tener distribuciones a priori gausianas, pero \\(\\theta\\) puede tener distribuciones a priori no gausianas.\nEl MLG se puede escribir formalmente como:\n\\[y \\vert x, \\theta \\sim \\prod \\pi (y_i \\vert \\eta_i, \\theta) \\\\\nx \\vert \\theta \\sim N(0, Q^{-1}(\\theta)) \\\\\n\\theta \\sim \\pi(\\theta)\\]"
  },
  {
    "objectID": "slides.html#por-qué-inla",
    "href": "slides.html#por-qué-inla",
    "title": "Modelos Espaciales",
    "section": "¿Por qué INLA?",
    "text": "¿Por qué INLA?\nLas distribuciones a posteriori de los modelos bayesianos no suelen estar disponibles analíticamente y usualmente se encuentran con métodos de simulación por cadenas de Markov Monte Carlo (MCMC) (Besag et al., 1995). Estos métodos han permitido resolver modelos complejos sin la necesidad de imponer estructuras que lo simplifiquen. Pero, el método MCMC conlleva alta demanda computacional. Rue et al (2009) propusieron una alternativa para aproximar la distribución a posteriori en contextos de datos espaciales. La simplificación se produce por el supuesto de existencia de un campo aleatorio gaussiano markoviano (las correlaciones espaciales sólo dependen de los sitios en el vecindario).\nINLA (Integrated Nested Laplace Approximations; Rue, Martino y Chopin, 2009) es un método que permite estimar la distribución marginal a posteriori de los parámetros. INLA permite la inferencia bayesiana de los Modelos Gaussianos Latentes."
  },
  {
    "objectID": "slides.html#pensando-en-términos-de-intervalos-de-credibilidad",
    "href": "slides.html#pensando-en-términos-de-intervalos-de-credibilidad",
    "title": "Modelos Espaciales",
    "section": "Pensando en términos de Intervalos de credibilidad",
    "text": "Pensando en términos de Intervalos de credibilidad\n\nLa información previa sobre los parámetros se resumen en distribuciones de probabilidad (distribuciones a priori) a partir de las cuales se estima la distribución de probabilidad a posteriori dadas las observaciones.\nLa estimaciones puntuales de los parámetros de interés se obtienen calculando medidas resumen de la distribución a posteriori.\nSe informan intervalos de credibilidad calculados desde percentiles de la distribución a posteriori.\nLa credibilidad se interpreta como la probabilidad de que el valor estimado para el parámetro pertenezca al intervalo reportado, dado los datos observados"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto.-efectos-fijos-y-aleatorios",
    "href": "slides.html#modelo-lineal-mixto.-efectos-fijos-y-aleatorios",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto. Efectos Fijos y Aleatorios",
    "text": "Modelo Lineal Mixto. Efectos Fijos y Aleatorios\n\\(Y\\) es función de covariables/factores de efectos fijos (constante) y aleatorios\nFijo vs. Aleatorio:\n\nNiveles arbitrariamente determinados vs. muestra aleatoria de niveles (asociado a una distribución de probabilidad)\nMecanismos de colección\nEspacio de inferencia\nEstrategia de modelación\nCantidad de niveles\nCalidad de la estimación de componentes de varianza\nCómputo de covarianzas"
  },
  {
    "objectID": "Ej01.html#datos",
    "href": "Ej01.html#datos",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Datos",
    "text": "Datos\nTrabajamos con datos de imágenes del satélite Landsat 5 TM, seleccionadas desde: USGS (USA): http://earthexplorer.usgs.gov/ e INPE (Brasil): http://www.inpe.br/.\nSe utilizaron datos pertenecientes a lotes de producción de caña de azúcar del noroeste argentino, expresados en toneladas de caña por hectárea (TCH) por lote, correspondientes a la zafra de 2009. Se eligieron 79 lotes con fecha de cosecha posterior a la fecha de la imagen satelital y se registraron los valores de TCH y las bandas de la imagen que seria usadas para predecir esa TCH. Todas los lotes fueron cosechado en verde (i.e. no-quema). De cada lote se registró además la edad del cultivo ya que la caña de azúcar es una especie semiperenne y algunos lotes eran del primer año de plantación (caña planta), mientras que otros del segundo año o primer rebrote (soca1) y otros de rebrotes de 2 o más años desde la plantación (entre paréntesis figura el nombre de la variable en el archivo de datos)\n\nUnidad de análisis (UM)\nLongitud (X_coord)\n\nLatitud (Y_coord)\n\nBanda 1 de la imagen satelital (Banda1)\n\nBanda 2 de la imagen satelital (Banda2)\n\nBanda 3 de la imagen satelital (Banda3)\n\nBanda 4 de la imagen satelital (Banda4)\n\nBanda 5 de la imagen satelital (Banda5)\n\nBanda 7 de la imagen satelital (Banda7)\n\nEdad en dos categorías: “Planta o Soca1” y “Soca2 o más” (EDAD)\nToneladas de caña por ha (TCH)\n\n\nLectura base de datos\n\n\nCarga paquetes y funciones\nlibrary(nlme)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(sf)\nlibrary(tmap)\n\n\nresumir_modelo <- function(modelo) {\n  \n  rmse <- function(modelo) {\n    sqrt(mean(modelo$residuals^2))\n  }\n  \n  aic <- AIC(modelo)\n  bic <- BIC(modelo)\n  my_rmse <- rmse(modelo)\n  regresora <- paste(attr(modelo$terms,\"term.labels\"), collapse = \", \")\n  \n  conCor <- ifelse(length(modelo$modelStruct), 'Si', 'No')\n  data.frame('Indice' = regresora,\n             'ConCorr' = conCor,\n             'AIC' = aic,\n             'BIC' = bic,\n             'RMSE' = my_rmse, \n             check.names = FALSE)\n}\n\ndiferenciaNormalizada <- function(x, y) {\n  (x - y) / (x + y)\n}\n\ntmap_options(basemaps = c(\n  'Satelital' = leaflet::providers$Esri.WorldImagery,\n  'OSM' = leaflet::providers$OpenStreetMap))\n\n\n\ndatos <- read.table(\"data/No_quemadas.txt\")\n\n\n\nCálculos de índices a partir de las bandas\n\nÍndice de Vegetación de Diferencia Normalizada (Normalized Difference Vegetation Index, NDVI)\n\n\n\n\n\n\n\nEl cálculo del NDVI se basa en la combinación de las bandas 3 (R) y 4 (NIR) de lansat ya que las plantas absorben la luz correspondiente a dichas bandas diferencialmente según su estado vegetativo.\n\n\n\n\\[NDVI = \\frac{NIR - R}{NIR + R} =  \\frac{B4 - B3}{B4 + B3}\\]\n\nNDVI verde (green NDVI, gNDVI). Permite capturar más específicamente la concentración de clorofila.\n\n\\[gNDVI = \\frac{NIR - G}{NIR + G} =  \\frac{B4 - B2}{B4 + B2}\\]\n\nÍndice de Canopeo Normalizado (Normalized Canopy Index, NCI), relacionado con el área foliar. Mayores valores de NCI indican menor área foliar y mayor cantidad de suelo desnudo, es decir menor canopeo.\n\n\\[NCI = \\frac{SWIR - G}{SWIR + G} =  \\frac{B5 - B2}{B5 + B2}\\]\n\ndatos <- datos |> \n  mutate(\n    ndvi = diferenciaNormalizada(Banda4, Banda3),\n    gndvi = diferenciaNormalizada(Banda4, Banda2),\n    nci = diferenciaNormalizada(Banda5, Banda2)\n  )\n\n\n\nVisualización espacial de los datos\n\ndatos_sf <-\n  sf::st_as_sf(datos,\n               coords = c('X_coord', 'Y_coord'),\n               crs = 32720)\n\ntmap_mode('view')\n\n\n\n\ntm_shape(datos_sf) +\n  tm_dots(col = 'TCH')\n\n\n\n\n\n\n\n\n\n\ntm_shape(datos_sf) +\n  tm_dots(col = 'ndvi')\n\n\n\n\n\n\n\n\n\n\nEstadística descriptiva\n\nGráficos\n\nggplot(datos, aes(TCH)) +\n  geom_histogram(aes(y = after_stat(count / sum(count))),\n                 bins = 15) +\n  labs(y = 'Frecuencia Relativa')\n\nggplot(datos, aes(EDAD, TCH)) +\n  geom_boxplot(width = 0.25)\n\n\n\n\n\n\nHistograma\n\n\n\n\n\n\n\nGráfico de cajas\n\n\n\n\n\n\n\n\n\nAnálisis de regresión Lineal\n\nNDVI\n\n\n\nggplot(datos, aes(ndvi, TCH)) +\n  geom_point()\n\n\n\n\nFigura 1: TCH en función de NDVI\n\n\n\n\n\nmodelo_ndvi <- gls(TCH ~ ndvi, \n                   data = datos, \n                   method = 'REML')\nsummary(modelo_ndvi)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ ndvi \n##   Data: datos \n##        AIC     BIC    logLik\n##   630.4788 637.471 -312.2394\n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept) -116.3873  33.64212 -3.459570   9e-04\n## ndvi         314.9360  51.70535  6.090974   0e+00\n## \n##  Correlation: \n##      (Intr)\n## ndvi -0.999\n## \n## Standardized residuals:\n##         Min          Q1         Med          Q3         Max \n## -2.08695971 -0.57298217 -0.01604275  0.55538562  2.81179426 \n## \n## Residual standard error: 14.54863 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\n\ngNDVI\n\n\n\nggplot(datos, aes(gndvi, TCH)) +\n  geom_point()\n\n\n\n\nFigura 2: TCH en función de gNDVI\n\n\n\n\n\nmodelo_gndvi <- gls(TCH ~ gndvi, \n                    data = datos, \n                    method = 'REML')\nsummary(modelo_gndvi)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ gndvi \n##   Data: datos \n##        AIC      BIC    logLik\n##   629.1229 636.1151 -311.5614\n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept) -165.8848  41.21302 -4.025058   1e-04\n## gndvi        448.9050  72.73257  6.171994   0e+00\n## \n##  Correlation: \n##       (Intr)\n## gndvi -0.999\n## \n## Standardized residuals:\n##           Min            Q1           Med            Q3           Max \n## -2.0868227416 -0.4850732735  0.0006377955  0.5531917024  2.8270446735 \n## \n## Residual standard error: 14.48515 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\n\nNCI\n\n\n\nggplot(datos, aes(nci, TCH)) +\n  geom_point()\n\n\n\n\nFigura 3: TCH en función de NCI\n\n\n\n\n\nmodelo_nci <-  gls(TCH ~ nci, \n                   data = datos, \n                   method = 'REML')\nsummary(modelo_nci)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ nci \n##   Data: datos \n##        AIC      BIC   logLik\n##   638.6299 645.6221 -316.315\n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept)  275.5376  38.31946  7.190539       0\n## nci         -504.6346 103.15799 -4.891861       0\n## \n##  Correlation: \n##     (Intr)\n## nci -0.999\n## \n## Standardized residuals:\n##          Min           Q1          Med           Q3          Max \n## -2.273389964 -0.534774349 -0.004252205  0.635330715  2.195348983 \n## \n## Residual standard error: 15.47764 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\n\n\nResumen de modelos ajustados\n\nrbind(\n  resumir_modelo(modelo_ndvi),\n  resumir_modelo(modelo_gndvi),\n  resumir_modelo(modelo_nci)\n  )\n\n\n\n\n\nIndice\nConCorr\nAIC\nBIC\nRMSE\n\n\n\n\nndvi\nNo\n630.4788\n637.4710\n14.36090\n\n\ngndvi\nNo\n629.1229\n636.1151\n14.29823\n\n\nnci\nNo\n638.6299\n645.6221\n15.27792"
  },
  {
    "objectID": "Ej01.html#ajuste-espacial",
    "href": "Ej01.html#ajuste-espacial",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Ajuste espacial",
    "text": "Ajuste espacial\n\nmodelo_ndvi_conCorr <- gls(\n  TCH ~ ndvi,\n  correlation = corExp(\n    form =  ~ as.numeric(as.character(X_coord)) + \n      as.numeric(as.character(Y_coord)),\n    metric = \"euclidean\",\n    nugget = FALSE\n  ),\n  data = datos,\n  method = 'REML'\n)\nsummary(modelo_ndvi_conCorr)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ ndvi \n##   Data: datos \n##        AIC      BIC    logLik\n##   627.2496 636.5725 -309.6248\n## \n## Correlation Structure: Exponential spatial correlation\n##  Formula: ~as.numeric(as.character(X_coord)) + as.numeric(as.character(Y_coord)) \n##  Parameter estimate(s):\n##    range \n## 1229.264 \n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept) -99.12808  35.03923 -2.829060   0.006\n## ndvi        285.90429  54.01696  5.292862   0.000\n## \n##  Correlation: \n##      (Intr)\n## ndvi -0.997\n## \n## Standardized residuals:\n##         Min          Q1         Med          Q3         Max \n## -1.87668595 -0.40251825  0.08934825  0.64328353  2.65467052 \n## \n## Residual standard error: 15.95641 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\nmodelo_gndvi_conCorr <- gls(\n  TCH ~ gndvi,\n  correlation = corExp(\n    form =  ~ as.numeric(as.character(X_coord)) + \n      as.numeric(as.character(Y_coord)),\n    metric = \"euclidean\",\n    nugget = FALSE\n  ),\n  data = datos,\n  method = 'REML'\n)\nsummary(modelo_gndvi_conCorr)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ gndvi \n##   Data: datos \n##        AIC      BIC    logLik\n##   623.8545 633.1774 -307.9273\n## \n## Correlation Structure: Exponential spatial correlation\n##  Formula: ~as.numeric(as.character(X_coord)) + as.numeric(as.character(Y_coord)) \n##  Parameter estimate(s):\n##    range \n## 1339.352 \n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept) -154.9457  42.98948 -3.604269   6e-04\n## gndvi        425.7714  75.95467  5.605598   0e+00\n## \n##  Correlation: \n##       (Intr)\n## gndvi -0.998\n## \n## Standardized residuals:\n##        Min         Q1        Med         Q3        Max \n## -1.7304645 -0.2923111  0.1405291  0.6403081  2.6966424 \n## \n## Residual standard error: 15.95296 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\nmodelo_nci_conCorr <- gls(\n  TCH ~ nci,\n  correlation = corExp(\n    form =  ~ as.numeric(as.character(X_coord)) +\n      as.numeric(as.character(Y_coord)),\n    metric = \"euclidean\",\n    nugget = FALSE\n  ),\n  data = datos,\n  method = 'REML'\n)\nsummary(modelo_nci_conCorr)\n\n## Generalized least squares fit by REML\n##   Model: TCH ~ nci \n##   Data: datos \n##        AIC      BIC    logLik\n##   636.5002 645.8232 -314.2501\n## \n## Correlation Structure: Exponential spatial correlation\n##  Formula: ~as.numeric(as.character(X_coord)) + as.numeric(as.character(Y_coord)) \n##  Parameter estimate(s):\n##    range \n## 791.3094 \n## \n## Coefficients:\n##                 Value Std.Error   t-value p-value\n## (Intercept)  257.4790  40.85657  6.302023   0e+00\n## nci         -457.4087 109.32719 -4.183851   1e-04\n## \n##  Correlation: \n##     (Intr)\n## nci -0.998\n## \n## Standardized residuals:\n##        Min         Q1        Med         Q3        Max \n## -2.1177676 -0.5221233  0.0235839  0.6875554  2.1389684 \n## \n## Residual standard error: 15.97278 \n## Degrees of freedom: 78 total; 76 residual\n\n\n\nrbind(\n  resumir_modelo(modelo_ndvi),\n  resumir_modelo(modelo_ndvi_conCorr),\n  resumir_modelo(modelo_gndvi),\n  resumir_modelo(modelo_gndvi_conCorr),\n  resumir_modelo(modelo_nci),\n  resumir_modelo(modelo_nci_conCorr)\n  )\n\n\n\n\n\nIndice\nConCorr\nAIC\nBIC\nRMSE\n\n\n\n\nndvi\nNo\n630.4788\n637.4710\n14.36090\n\n\nndvi\nSi\n627.2496\n636.5725\n14.48017\n\n\ngndvi\nNo\n629.1229\n636.1151\n14.29823\n\n\ngndvi\nSi\n623.8545\n633.1774\n14.46971\n\n\nnci\nNo\n638.6299\n645.6221\n15.27792\n\n\nnci\nSi\n636.5002\n645.8232\n15.30830\n\n\n\n\n\n\n\nef_fijos_ndvo_iid <- summary(modelo_ndvi)\nef_fijos_ndvo_iid$tTable\n\n##                 Value Std.Error   t-value      p-value\n## (Intercept) -116.3873  33.64212 -3.459570 8.903363e-04\n## ndvi         314.9360  51.70535  6.090974 4.273028e-08\n\n\n\nef_fijos_ndvo_corr <- summary(modelo_ndvi_conCorr)\nef_fijos_ndvo_corr$tTable\n\n##                 Value Std.Error   t-value      p-value\n## (Intercept) -99.12808  35.03923 -2.829060 5.967466e-03\n## ndvi        285.90429  54.01696  5.292862 1.128048e-06\n\n\n\npredichos_lm <- datos\npredichos_lm$pred_ndvi_iid <- predict(modelo_ndvi)\npredichos_lm$pred_ndvi_esp <- predict(modelo_ndvi_conCorr)\n\n\nggplot(predichos_lm, aes(pred_ndvi_iid, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\nggplot(predichos_lm, aes(pred_ndvi_esp, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\nggplot(predichos_lm, aes(pred_ndvi_esp, pred_ndvi_iid)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)"
  },
  {
    "objectID": "slidespage.html",
    "href": "slidespage.html",
    "title": "Modelos Espaciales",
    "section": "",
    "text": "Mostrar en una nueva pestaña"
  },
  {
    "objectID": "test.html",
    "href": "test.html",
    "title": "Penguins",
    "section": "",
    "text": "viewof bill_length_min = Inputs.range(\n  [32, 50], \n  {value: 35, step: 1, label: \"Bill length (min):\"}\n)\nviewof islands = Inputs.checkbox(\n  [\"Torgersen\", \"Biscoe\", \"Dream\"], \n  { value: [\"Torgersen\", \"Biscoe\"], \n    label: \"Islands:\"\n  }\n)\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nPlotData\n\n\n\nPlot.rectY(filtered, \n  Plot.binX(\n    {y: \"count\"}, \n    {x: \"body_mass_g\", fill: \"species\", thresholds: 20}\n  ))\n  .plot({\n    facet: {\n      data: filtered,\n      x: \"sex\",\n      y: \"species\",\n      marginRight: 80\n    },\n    marks: [\n      Plot.frame(),\n    ]\n  }\n)\n\n\n\n\n\n\n\n\n\nInputs.table(filtered)\n\n\n\n\n\n\n\n\n\n\ndata = FileAttachment(\"palmer-penguins.csv\").csv({ typed: true })\n\n\n\n\n\n\n\nfiltered = data.filter(function(penguin) {\n  return bill_length_min < penguin.bill_length_mm &&\n         islands.includes(penguin.island);\n})"
  },
  {
    "objectID": "Ej03.html",
    "href": "Ej03.html",
    "title": "High Plains Wheat Mosaic Virus (HPWMoV) en cultivos de maíz y trigo",
    "section": "",
    "text": "Se sistematizó información desde la primera detección en el pais del virus.\nSe generó un registro de presencia/ausencia georreferenciado según año y localidad de muestreo.\nContamos con 169 observaciones para HPWMoV en maíz y 451 obsevaciones en trigo.\nLas observaciones no estan alineadas\n\n\nsuppressPackageStartupMessages({\n  library(sf)\n  library(dplyr)\n  library(tmap)\n  library(tidyr)\n  library(INLA)\n})\nsource(\"src/spde-book-functions.R\")\ntmap_mode(\"view\")\n\n\ntrigo_maiz <- st_read(\"data/trigo_maiz_26_09_22.gpkg\", quiet = TRUE)\nst_geometry(trigo_maiz) <- 'geometry'\ntrigo_maiz$HPV <- as.factor(trigo_maiz$HPV)\n\n\nhpv_maiz <- trigo_maiz |>\n  filter(Especie == \"Maíz\" & !is.na(HPV))\n\nhpv_trigo <- trigo_maiz |>\n  filter(Especie == \"Trigo\" & !is.na(HPV)) \n\n\ntm_shape(hpv_maiz) +\n  tm_dots(\"HPV\", title = \"HPV en Maiz\", pal = \"Dark2\") +\n  tm_shape(hpv_trigo) +\n  tm_dots(\"HPV\", title = \"HPV en Trgio\", pal = \"Set1\")\n\n\n\n\n\n\nComplementariamente, se obtuvieron 117 variables biometeorológicas, usando la plataforma ERA5, en el periodo comprendido entre agosto del año en que se tomo la muestra y agosto del año siguiente."
  },
  {
    "objectID": "Ej03.html#armado-del-modelo",
    "href": "Ej03.html#armado-del-modelo",
    "title": "High Plains Wheat Mosaic Virus (HPWMoV) en cultivos de maíz y trigo",
    "section": "Armado del modelo",
    "text": "Armado del modelo\n\nCargamos la base de datos\n\ntrigo_hpv_sf2 <- st_read(\"data/trigo_hpv.gpkg\",quiet = TRUE)\nst_geometry(trigo_hpv_sf2) <- 'geometry'\n\n\n\nCargamos los limites de la region donde hay datos\n\nlimites2 <- st_read(\"data/limites2.gpkg\", quiet = TRUE)\nst_geometry(limites2) <- 'geometry'\n\n\ntm_shape(trigo_hpv_sf2) +\n  tm_dots() +\n  tm_shape(limites2) +\n  tm_polygons(alpha = 0)\n\n\n\n\n\n\n\n\nBoundary\n\nbase_maiz <- trigo_hpv_sf2 |>\n  drop_na(HPV_maiz)\n\nloc.maiz <- base_maiz |>\n  st_coordinates()\n\n\nbase_trigo <- trigo_hpv_sf2 |>\n  drop_na(HPV_trigo)\n\nloc.trigo <- base_trigo |>\n  st_coordinates()\n\nloc.obs <- st_coordinates(trigo_hpv_sf2)\n\nboundary <- list(inla.nonconvex.hull(loc.obs, 2),\n                 inla.nonconvex.hull(loc.obs, 4))\n\n\n\nMesh\n\nmesh <- inla.mesh.2d(\n  boundary = boundary,\n  max.edge = c(0.4, 0.8),\n  min.angle = c(30, 21),\n  max.n = c(480, 160),\n  max.n.strict = c(128000, 128000),\n  cutoff = 0.03,\n  offset = c(2, 4)\n)\n\nplot(mesh)\npoints(loc.obs, pch = 16, col = \"#FF5300\")\n\n\n\n\n\n\nSPDE - Modelo espacial\n\nspde <- inla.spde2.pcmatern(\n  mesh = mesh,\n  # P(range < rangemin) = 0.01\n  prior.range = c(1000, 0.01),\n  prior.sigma = c(10, 0.01)\n)\n\n\n\nFormula\n\nform <- y ~ -1 +\n  intercept_hpv_maiz+\n  intercept_hpv_trigo +\n  \n  Precipitacion_Jan_maiz + \n  Punto.rocio_May_maiz + \n  anio_maiz + \n  \n  Precipitacion_Jan_trigo + \n  Temperatura_Jun_trigo +\n  \n  f(s1, model = spde) + \n  f(s2, model = spde) + \n  f(s12, copy = \"s1\", fixed = FALSE)\n\n\n\nMatrices de Proyeccion\n\nAmaiz <- inla.spde.make.A(mesh,loc.maiz)\n\nAtrigo <- inla.spde.make.A(mesh, loc.trigo)\n\n\n\nStacks\n\nstackMaiz <- inla.stack(\n  data = list(y = cbind(NA, base_maiz$HPV_maiz)),\n  A = list(Amaiz,1),\n  effects = list(\n    list(s1 = 1:spde$n.spde),\n    list(intercept_hpv_trigo = rep(1, nrow(base_maiz)),\n         \n         Precipitacion_Jan_maiz  = base_maiz$Precipitacion_Jan,\n         Punto.rocio_May_maiz = base_maiz$Punto.rocio_May,\n         anio_maiz = base_maiz$Año.de.Colecta,\n         \n         Precipitacion_Jan_trigo  = rep(NA, nrow(base_maiz)),\n         Temperatura_Jun_trigo = rep(NA, nrow(base_maiz))\n         )\n    \n  ),\n  tag = \"WSMV_maiz\")\n\n\nstackTrigo <- inla.stack(\n  data = list(y = cbind(base_trigo$HPV_trigo,NA)),\n  A = list(Atrigo,1),\n  effects = list(\n    list(s2 = 1:spde$n.spde, s12 = 1:spde$n.spde),\n    list(intercept_hpv_maiz = rep(1, nrow(base_trigo)),\n         \n         Precipitacion_Jan_maiz  = rep(NA, nrow(base_trigo)),\n         Punto.rocio_May_maiz = rep(NA, nrow(base_trigo)),\n         anio_maiz = rep(NA, nrow(base_trigo)),\n         \n         Precipitacion_Jan_trigo = base_trigo$Precipitacion_Jan,\n         Temperatura_Jun_trigo = base_trigo$Temperatura_Jun \n           )\n  ),\n  tag = \"WSMV_trigo\")\n\n\nstack <- inla.stack(stackTrigo,stackMaiz)\n\n\n\nResultados\n\nset.seed(123)\nresult <- inla(\n  form,\n  rep('binomial', 2),\n  data = inla.stack.data(stack),\n  control.predictor = list(\n    compute = TRUE,\n    A = inla.stack.A(stack),\n    link = 1\n  ),\n  \n  control.compute = list(\n    return.marginals = TRUE,\n    return.marginals.predictor = TRUE,\n    hyperpar = TRUE\n  )\n)\n\nresult$summary.fixed\n\nresult$summary.hyperpar\n\n##                                mean          sd    0.025quant    0.5quant\n## intercept_hpv_maiz       0.29144210 31.58334318 -61.648414324  0.29145616\n## intercept_hpv_trigo     -0.68326085 31.53128063 -62.520910889 -0.68328386\n## Precipitacion_Jan_maiz   0.13965405  0.04791587   0.046843840  0.13923924\n## Punto.rocio_May_maiz    -0.02639330  0.06890882  -0.161692891 -0.02633940\n## anio_maiz                0.05881419  0.03119437  -0.002294633  0.05878974\n## Precipitacion_Jan_trigo  0.51635013  0.07998734   0.363190740  0.51501988\n## Temperatura_Jun_trigo   -0.14811952  0.08565391  -0.318086909 -0.14744784\n##                          0.975quant mode          kld\n## intercept_hpv_maiz      62.23121946   NA 8.500668e-11\n## intercept_hpv_trigo     61.15451836   NA 2.208675e-10\n## Precipitacion_Jan_maiz   0.23482202   NA 1.328229e-07\n## Punto.rocio_May_maiz     0.10860012   NA 6.353955e-07\n## anio_maiz                0.12006163   NA 8.104218e-07\n## Precipitacion_Jan_trigo  0.67707317   NA 1.556447e-07\n## Temperatura_Jun_trigo    0.01804228   NA 7.686951e-08\n##                     mean          sd  0.025quant    0.5quant  0.975quant mode\n## Range for s1  151.131792  7.25585360  137.341859  150.957915  165.923866   NA\n## Stdev for s1   64.783851  4.50614710   56.361047   64.627701   74.106852   NA\n## Range for s2 1282.529862 80.03331382 1132.099900 1280.039985 1447.312524   NA\n## Stdev for s2    9.606246  0.64269492    8.402452    9.584819   10.933565   NA\n## Beta for s12    1.547859  0.04630311    1.456640    1.547859    1.639079   NA\n\n\n\npar(mfrow = n2mfrow(length(names(result$marginals.fixed)), asp = 1))\ninvisible(\n  sapply(names(result$marginals.fixed), function(x) {\n    \n    plot(result$marginals.fixed[[x]], type = 'l', \n         xlab = x, ylab = 'Density')\n    abline(v = 0)\n  })\n)\n\n\n\n\n\npar(mfrow = n2mfrow(length(names(result$marginals.hyperpar)), asp = 1))\nfor (j in names(result$marginals.hyperpar)) {\n  ii <- result$marginals.hyperpar[[j]][,2] > sqrt(.Machine$double.eps)\n  plot(result$marginals.hyperpar[[j]], \n       type = 'l', \n       xlim = range(result$marginals.hyperpar[[j]][ii, 1]), \n       xlab = names(result$marginals.hyperpar)[j], \n       ylab = 'Density',\n       main = j)\n}\n\n\n\n\nPara validar el modelo se realizó un validación cruzada k-fold, con un k = 10, para cada cultivo.\nLos resultados indicaron que la modelación conjunta permitió aumentar la capacidad predictiva de la presencia de virus en el cultivo de trigo en relación al clima, respecto a la obtenida en el modelo marginal con las mismas regresoras.\n\n\n\n\n\n\n\nHPV\n\n\n\n\n\n\n\n\n\n\nMaíz\n\n\nTrigo"
  },
  {
    "objectID": "Ej01.html#motivación",
    "href": "Ej01.html#motivación",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Motivación",
    "text": "Motivación\nLa generación de datos a partir de imágenes satelitales, constituyen una fuente valiosa de información, pudiéndose construir incluso series históricas de imagen de un sitio. En bioestadística este tipo de datos se usa para monitorear ecosistemas, realizar pronósticos climáticos y predecir cosechas, entre otros.\nEn este caso mostramos la implementación de un análisis exploratorio de datos para caracterizar la variable toneladas de caña por hectárea. Luego estudiaremos el uso de modelos de regresión lineal para estimar rendimientos de caña de azúcar a partir de índices de vegetación elaborados con información proveniente de sensores remotos."
  },
  {
    "objectID": "Ej02.html",
    "href": "Ej02.html",
    "title": "Ejemplo 2: Modelación de casos de COVID",
    "section": "",
    "text": "Al comenzar la pandemia producida por COVID-19, surgió el interés de analizar la distribución espacial de los riesgos infección.\nAjustamos un modelos lineal generalizado con efectos aleatorios espaciales con INLA para estimar riesgo de aparición del virus en diferentes radios censales de la Ciudad de Córdoba, Argentina."
  },
  {
    "objectID": "Ej02.html#ajuste-del-modelo",
    "href": "Ej02.html#ajuste-del-modelo",
    "title": "Ejemplo 2: Modelación de casos de COVID",
    "section": "Ajuste del Modelo",
    "text": "Ajuste del Modelo\n\nGeneración de lista con vecindarios\n\n# Generación de lista con vecindarios\nnb <- poly2nb(datos)\n\nhead(nb)\n\nplot(st_geometry(datos), border = \"grey\", lwd = 0.5)\nplot(\n  nb,\n  coordinates(as(datos, \"Spatial\")),\n  add = TRUE,\n  col = \"blue\",\n  points = FALSE,\n  lwd = 0.5\n)\n\n\n\n\n## [[1]]\n##  [1]    2    3    4   29   37  237  251  252  258  266  267 1498 1500\n## \n## [[2]]\n## [1]  1  3  8 14 37\n## \n## [[3]]\n## [1] 1 2 4 8\n## \n## [[4]]\n## [1]   1   3   5   6   7   8 266 267\n## \n## [[5]]\n## [1]   4   6 267\n## \n## [[6]]\n## [1]   4   5   7  10  11 270\n\n\n\n# Generación de vecindarios para INLA\nfile_adj <- tempfile(\"map.adj1\")\nnb2INLA(file_adj, nb)\ng <- inla.read.graph(filename = file_adj)\n\n\n# Ajuste del Modelo inflado en ceros\nsummary(datos)\n\n\nformula  <-\n  Casos ~ \n  Fragmentacion +  \n  HogaresNBI + \n  HogaresHacinamiento +\n  HogaresJefe.Univ. + \n  Bancos + \n  f(re_u, model = \"besag\", graph = g) + \n  f(re_v, model = \"iid\")\n\n# formula  <-\n#   Casos ~ Bancos + ValorTierra +  f(re_u, model = \"besag\", graph = g) + f(re_v, model = \"iid\")\n\nres_inflpoi <-\n  inla(\n    formula,\n    family = \"zeroinflatedpoisson1\",\n    data = datos,\n    E = E,\n    control.predictor = list(compute = TRUE)\n  )\nsummary(res_inflpoi)\n\n##    Poblacion      Fragmentacion    ValorTierra         HogaresNBI     \n##  Min.   :   7.0   Min.   :1.000   Min.   : 0.01171   Min.   : 0.0000  \n##  1st Qu.: 629.8   1st Qu.:2.000   1st Qu.: 0.14349   1st Qu.: 0.3755  \n##  Median : 835.0   Median :4.000   Median : 0.35141   Median : 1.0855  \n##  Mean   : 873.2   Mean   :3.367   Mean   : 1.00000   Mean   : 1.6939  \n##  3rd Qu.:1086.0   3rd Qu.:4.000   3rd Qu.: 0.73210   3rd Qu.: 2.4040  \n##  Max.   :3273.0   Max.   :4.000   Max.   :12.88503   Max.   :20.6897  \n##  HogaresHacinamiento HogaresJefe.Univ. HogaresConComput.     HabSup       \n##  Min.   :0.0000      Min.   : 0.0000   Min.   : 0.00     Min.   :  0.006  \n##  1st Qu.:0.1364      1st Qu.: 0.9802   1st Qu.:11.96     1st Qu.: 44.619  \n##  Median :0.5051      Median : 3.3943   Median :18.05     Median : 73.769  \n##  Mean   :0.8617      Mean   : 5.5653   Mean   :20.02     Mean   : 83.815  \n##  3rd Qu.:1.2639      3rd Qu.: 9.0126   3rd Qu.:25.26     3rd Qu.: 97.168  \n##  Max.   :6.6606      Max.   :26.6055   Max.   :57.17     Max.   :606.024  \n##      Bancos          Farmacias       EstSaludInt     Ban_Farm_Salud  \n##  Min.   :0.00000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  \n##  1st Qu.:0.00000   1st Qu.:0.0000   1st Qu.:0.0000   1st Qu.:0.0000  \n##  Median :0.00000   Median :0.0000   Median :0.0000   Median :0.0000  \n##  Mean   :0.05301   Mean   :0.2446   Mean   :0.1536   Mean   :0.4512  \n##  3rd Qu.:0.00000   3rd Qu.:0.0000   3rd Qu.:0.0000   3rd Qu.:1.0000  \n##  Max.   :8.00000   Max.   :6.0000   Max.   :6.0000   Max.   :9.0000  \n##      Casos                    geom            E                 SIR        \n##  Min.   : 0.0000   MULTIPOLYGON :1660   Min.   :0.002241   Min.   : 0.000  \n##  1st Qu.: 0.0000   epsg:22174   :   0   1st Qu.:0.201595   1st Qu.: 0.000  \n##  Median : 0.0000   +proj=tmer...:   0   Median :0.267299   Median : 0.000  \n##  Mean   : 0.2795                        Mean   :0.279518   Mean   : 1.007  \n##  3rd Qu.: 0.0000                        3rd Qu.:0.347649   3rd Qu.: 0.000  \n##  Max.   :36.0000                        Max.   :1.047749   Max.   :89.967  \n##       re_u             re_v       \n##  Min.   :   1.0   Min.   :   1.0  \n##  1st Qu.: 415.8   1st Qu.: 415.8  \n##  Median : 830.5   Median : 830.5  \n##  Mean   : 830.5   Mean   : 830.5  \n##  3rd Qu.:1245.2   3rd Qu.:1245.2  \n##  Max.   :1660.0   Max.   :1660.0  \n## \n## Call:\n##    c(\"inla.core(formula = formula, family = family, contrasts = contrasts, \n##    \", \" data = data, quantiles = quantiles, E = E, offset = offset, \", \" \n##    scale = scale, weights = weights, Ntrials = Ntrials, strata = strata, \n##    \", \" lp.scale = lp.scale, link.covariates = link.covariates, verbose = \n##    verbose, \", \" lincomb = lincomb, selection = selection, control.compute \n##    = control.compute, \", \" control.predictor = control.predictor, \n##    control.family = control.family, \", \" control.inla = control.inla, \n##    control.fixed = control.fixed, \", \" control.mode = control.mode, \n##    control.expert = control.expert, \", \" control.hazard = control.hazard, \n##    control.lincomb = control.lincomb, \", \" control.update = \n##    control.update, control.lp.scale = control.lp.scale, \", \" \n##    control.pardiso = control.pardiso, only.hyperparam = only.hyperparam, \n##    \", \" inla.call = inla.call, inla.arg = inla.arg, num.threads = \n##    num.threads, \", \" blas.num.threads = blas.num.threads, keep = keep, \n##    working.directory = working.directory, \", \" silent = silent, inla.mode \n##    = inla.mode, safe = FALSE, debug = debug, \", \" .parent.frame = \n##    .parent.frame)\") \n## Time used:\n##     Pre = 2.28, Running = 36.1, Post = 1.44, Total = 39.8 \n## Fixed effects:\n##                       mean    sd 0.025quant 0.5quant 0.975quant   mode kld\n## (Intercept)         -0.662 0.492     -1.641   -0.658      0.287 -0.648   0\n## Fragmentacion        0.169 0.106     -0.036    0.168      0.378  0.167   0\n## HogaresNBI          -0.052 0.070     -0.199   -0.050      0.078 -0.044   0\n## HogaresHacinamiento  0.115 0.140     -0.154    0.113      0.397  0.108   0\n## HogaresJefe.Univ.    0.052 0.023      0.008    0.052      0.097  0.052   0\n## Bancos               0.138 0.194     -0.249    0.140      0.514  0.145   0\n## \n## Random effects:\n##   Name     Model\n##     re_u Besags ICAR model\n##    re_v IID model\n## \n## Model hyperparameters:\n##                                                          mean     sd 0.025quant\n## zero-probability parameter for zero-inflated poisson_1  0.598  0.052      0.503\n## Precision for re_u                                      0.346  0.062      0.242\n## Precision for re_v                                     31.850 40.820      5.001\n##                                                        0.5quant 0.975quant\n## zero-probability parameter for zero-inflated poisson_1    0.595      0.706\n## Precision for re_u                                        0.340      0.485\n## Precision for re_v                                       19.933    134.836\n##                                                          mode\n## zero-probability parameter for zero-inflated poisson_1  0.581\n## Precision for re_u                                      0.327\n## Precision for re_v                                     10.215\n## \n## Marginal log-Likelihood:  -2315.06 \n##  is computed \n## Posterior summaries for the linear predictor and the fitted values are computed\n## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')"
  },
  {
    "objectID": "Ej02.html#visualización-interactiva",
    "href": "Ej02.html#visualización-interactiva",
    "title": "Ejemplo 2: Modelación de casos de COVID",
    "section": "Visualización Interactiva",
    "text": "Visualización Interactiva\n\ndatos$RR <- res_inflpoi$summary.fitted.values[, \"mean\"]\ndatos$RR_LI <- res_inflpoi$summary.fitted.values[, \"0.025quant\"]\ndatos$RR_LS <- res_inflpoi$summary.fitted.values[, \"0.975quant\"]\n\npopup_vars <- c(\n  \"Fragmentación (Nivel)\" = 'Fragmentacion',\n  \"Valor Tierra Medio ($/m2)\" = 'ValorTierra',\n  \"Hogares NBI (%)\" = 'HogaresNBI',\n  \"Hogares Hacinamiento (%)\" = 'HogaresHacinamiento',\n  \"Hogares Jefe Univ.(%)\" = 'HogaresJefe.Univ.',\n  \"Bancos\",\n  \"Casos\",\n  \"Población\" = 'Poblacion',\n  \"E\",\n  \"SIR\",\n  \"RR_LI\",\n  \"RR\",\n  \"RR_LS\"\n)\n\n\ntmap_mode('view')\nmapas <-\n  tm_basemap(c(Urbano = \"OpenStreetMap\", Satelite = \"Esri.WorldImagery\")) +\n  tm_shape(datos,\n           name = 'Casos')  +\n  tm_polygons(\n    col = \"Casos\",\n    id = \"Casos\",\n    border.col = \"gray50\",\n    border.alpha = .5,\n    style = \"fixed\",\n    title = \"Casos por Radio\",\n    palette = \"YlOrBr\",\n    breaks = c(0, 1, 2, 3, 5, 10, 15, 25, 36),\n    popup.vars = popup_vars,\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 0\n    )\n  ) +\n  \n  tm_shape(datos,\n           name = 'Tasa de Infección - SIR')  +\n  tm_polygons(\n    col = \"SIR\",\n    id = \"SIR\",\n    border.col = \"gray50\",\n    border.alpha = .5,\n    style = \"fixed\",\n    palette = hcl.colors(7, \"ag_GrnYl\"),\n    breaks = c(0, 5, 10, 15, 20, 25, 30, 50, 60, 90),\n    popup.vars = popup_vars,\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 0\n    )\n  ) +\n  \n  tm_shape(datos,\n           name = 'Riesgo Relativo')  +\n  tm_polygons(\n    col = \"RR\",\n    id = \"RR\",\n    style = \"fixed\",\n    palette = \"viridis\",\n    alpha = 0.8,\n    title = \"Riesgo Relativo\",\n    breaks = c(0.4, 1, 2, 4, 8, 10, 15, 20, 30, 50, 85, 96),\n    popup.vars = popup_vars,\n    border.col = \"gray50\",\n    border.alpha = .5,\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 1\n    )\n  )\nmapas\n\n\n\n\n\n\n\nimg <-\n  \"https://ig.conae.unc.edu.ar/wp-content/uploads/sites/68/2022/04/cropped-cromas-68-1.png\"\n\nmap <-\n  tmap_leaflet(mapas) %>%\n  leafem::addLogo(img,\n                  url = \"https://ig.conae.unc.edu.ar/\",\n                  width = 136,\n                  height = 50) %>%\n  leaflet::addMiniMap(position = \"bottomleft\",\n                      width = 150,\n                      height = 150)\nmap\n\n# mapshot(map, paste0(\"Mapa_radios_\", format(Sys.time(), \"%d_%m_%Y\"), \".html\"))"
  },
  {
    "objectID": "Ej02.html#visualización-estática",
    "href": "Ej02.html#visualización-estática",
    "title": "Ejemplo 2: Modelación de casos de COVID",
    "section": "Visualización Estática",
    "text": "Visualización Estática\n\ntmap_mode('plot')\n\nboundary_box <- matrix(c(4357000, 6508000, 4405900, 6560000))\n\nmapacasos <-\n  tm_shape(datos, bbox = boundary_box)  +\n  tm_polygons(\n    col = \"Casos\",\n    id = \"Casos\",\n    border.col = \"gray50\",\n    border.alpha = .5,\n    style = \"fixed\",\n    title = \"Casos por Radio\",\n    palette = \"YlOrBr\",\n    breaks = c(0, 1, 2, 3, 5, 10, 15, 25, 36),\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 0\n    )\n  ) + \n  tm_scale_bar(position = c(\"right\", \"bottom\")) +\n  tm_compass(type = \"8star\", position = c(\"left\", \"bottom\"))\n\nmapacasos\n\n\n\nmapaSIR <-\n  tm_shape(datos, bbox = boundary_box)  +\n  tm_polygons(\n    col = \"SIR\",\n    id = \"SIR\",\n    border.col = \"gray50\",\n    border.alpha = .5,\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    breaks = c(0, 5, 10, 15, 20, 25, 30, 50, 60, 90),\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 0\n    )\n  ) + \n  tm_scale_bar(position = c(\"right\", \"bottom\")) +\n  tm_compass(type = \"8star\", position = c(\"left\", \"bottom\"))\n\nmapaSIR\n\n\n\nmapaRR <-\n  tm_shape(datos, bbox = boundary_box)  +\n  tm_polygons(\n    col = \"RR\",\n    id = \"RR\",\n    style = \"fixed\",\n    palette = \"YlOrBr\",\n    title = \"Riesgo Relativo\",\n    breaks = c(0.4, 1, 2, 4, 8, 10, 15, 20, 30, 50, 85, 96),\n    border.col = \"gray50\",\n    border.alpha = .5,\n    legend.format = list(\n      scientific = TRUE,\n      format = \"f\",\n      digits = 1\n    )\n  ) + \n  tm_scale_bar(position = c(\"right\", \"bottom\")) +\n  tm_compass(type = \"8star\", position = c(\"left\", \"bottom\"))\n\nmapaRR"
  },
  {
    "objectID": "Ej01.html#generación-grilla-espacial-y-modelo-matern-spde",
    "href": "Ej01.html#generación-grilla-espacial-y-modelo-matern-spde",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Generación grilla espacial y modelo Matern SPDE",
    "text": "Generación grilla espacial y modelo Matern SPDE\n\nloc <- st_coordinates(datos_sf)\n\nmesh <- INLA::inla.mesh.2d(\n  loc = loc,\n  offset = c(1000, 4000),\n  cutoff = 800,\n  max.edge = c(1000, 2000),\n  max.n = 10000)\n\n\nggplot(datos_sf) +\n  gg(mesh) +\n  geom_sf()\n\n\n\nspde <- INLA::inla.spde2.pcmatern(\n  mesh = mesh,\n  prior.range = c(2000, 0.05),\n  prior.sigma = c(200, 0.01)\n)\n\n\nproj_obs <- inla.mesh.projector(mesh, loc = loc)\nproj_pred <- inla.mesh.projector(mesh, loc = mesh$loc)\n\nA_obs <- inla.spde.make.A(mesh, loc = loc)\nA_pred <- inla.spde.make.A(mesh, loc = proj_pred$loc)\nidx <- 1:spde$n.spde\n\nstack_obs <-\n  inla.stack(\n    data = list(y = datos_sf$TCH),\n    A = list(A_obs, 1),\n    effects = list(c(\n      list(Intercept = 1),\n      inla.spde.make.index(\"spatial\", spde$n.spde)\n    ),\n    covar = datos_sf$ndvi),\n    tag = \"obs\"\n  )\nstack_pred <-\n  inla.stack(\n    data = list(y = NA),\n    A = list(A_pred),\n    effects = list(c(\n      list(Intercept = 1),\n      inla.spde.make.index(\"spatial\", mesh$n)\n    )),\n    tag = \"pred\"\n  )\nstack <- inla.stack(stack_obs, stack_pred)\n\n\nformula <- y ~ -1 + Intercept + covar +\n    f(spatial, model = spde)\n\nresult1 <- inla(\n  formula,\n  data = inla.stack.data(stack_obs, spde = spde),\n  family = \"gaussian\",\n  control.predictor = list(A = inla.stack.A(stack_obs),\n                           compute = TRUE)\n)\nsummary(result1)\n\n\nplot(datos_sf$TCH, \n     result1$summary.fitted.values[inla.stack.index(stack_obs, \"obs\")$data, \"mean\"],\n     main = \"Observations vs posterior predicted values at the data locations\")\n\n# \n# field_pred <- inla.mesh.project(proj_pred,\n#                                 result1$summary.fitted.values[inla.stack.index(stack, \"pred\")$data, \"mean\"])\n# field_pred_sd <- inla.mesh.project(proj_pred,\n#                                    result1$summary.fitted.values[inla.stack.index(stack, \"pred\")$data, \"sd\"])\n# \n# image(inla.mesh.project(mesh,\n#                         field = field_pred,\n#                         dims = c(200, 200)),\n#       main = \"Posterior field mean\")\n# image(inla.mesh.project(mesh,\n#                         field = field_pred_sd,\n#                         dims = c(200, 200)),\n#       main = \"Prediction standard deviation\")\n\n\nndvi_bru_spde <-\n  bru(\n    TCH ~ Intercept(1) + ndvi + site(main = coordinates, model = spde),\n    family = \"gaussian\",\n    data = as_Spatial(datos_sf)\n  )\n\nsummary(ndvi_bru_spde)\n\n## inlabru version: 2.5.3\n## INLA version: 22.10.13\n## Components:\n##   Intercept: Model types main='linear', group='exchangeable', replicate='iid'\n##   ndvi: Model types main='linear', group='exchangeable', replicate='iid'\n##   site: Model types main='spde', group='exchangeable', replicate='iid'\n## Likelihoods:\n##   Family: 'gaussian'\n##     Data class: 'SpatialPointsDataFrame'\n##     Predictor: TCH ~ .\n## Time used:\n##     Pre = 3.86, Running = 7.84, Post = 0.594, Total = 12.3 \n## Fixed effects:\n##             mean     sd 0.025quant 0.5quant 0.975quant   mode kld\n## Intercept 31.298 16.663     -1.334   31.276     64.047 31.231   0\n## ndvi      79.801 24.893     30.758   79.881    128.397 80.043   0\n## \n## Random effects:\n##   Name     Model\n##     site SPDE2 model\n## \n## Model hyperparameters:\n##                                             mean       sd 0.025quant 0.5quant\n## Precision for the Gaussian observations    0.011    0.005      0.005    0.011\n## Range for site                          6827.928 3239.781   2608.525 6146.314\n## Stdev for site                            16.247    3.602     10.216   15.895\n##                                         0.975quant     mode\n## Precision for the Gaussian observations   2.30e-02    0.009\n## Range for site                            1.51e+04 5005.853\n## Stdev for site                            2.43e+01   15.241\n## \n## Deviance Information Criterion (DIC) ...............: 615.48\n## Deviance Information Criterion (DIC, saturated) ....: 14385.92\n## Effective number of parameters .....................: 37.10\n## \n## Watanabe-Akaike information criterion (WAIC) ...: 620.13\n## Effective number of parameters .................: 32.96\n## \n## Marginal log-Likelihood:  -346.58 \n##  is computed \n## Posterior summaries for the linear predictor and the fitted values are computed\n## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')\n\n\n\nplot(ndvi_bru_spde, \"Intercept\")\nplot(ndvi_bru_spde, \"ndvi\")\nplot(ndvi_bru_spde, \"site\")\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nspde.posterior(ndvi_bru_spde, \"site\", what = \"matern.covariance\") -> covplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"matern.correlation\") -> corplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"range\") -> rngplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"log.range\") -> lgrngplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"variance\") -> varplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"log.variance\") -> lgvarplot\nmultiplot(plot(covplot), plot(corplot),\n          plot(rngplot), plot(lgrngplot),\n          plot(varplot), plot(lgvarplot))\n\n\n\n\n\nObservados vs. distribución a posteriori\n\npred_mesh <-\n  predict(ndvi_bru_spde, as_Spatial(datos_sf), ~ Intercept + ndvi + site)\npredichos <- st_as_sf(pred_mesh)\n\nggplot(predichos, aes(mean, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\n\n\n\n# pred_mesh <-\n#   predict(ndvi_bru_spde, pixels(mesh), ~ Intercept + ndvi + site)\n# \n# ggplot() +\n#   gg(pred_mesh)\n# ggplot(datos_sf) +\n#   gg(pred_mesh) +\n#   gg(mesh) +\n#   geom_sf()"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto.-efectos-fijos-vs.-aleatorios",
    "href": "slides.html#modelo-lineal-mixto.-efectos-fijos-vs.-aleatorios",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto. Efectos Fijos vs. Aleatorios",
    "text": "Modelo Lineal Mixto. Efectos Fijos vs. Aleatorios\n\nNiveles arbitrariamente determinados vs. muestra aleatoria de niveles (asociado a una distribución de probabilidad)\nMecanismos de colección\nEspacio de inferencia\nEstrategia de modelación\nCantidad de niveles\nCalidad de la estimación de componentes de varianza\nCómputo de covarianzas"
  },
  {
    "objectID": "slides.html#modelo-lineal-generalizado-1",
    "href": "slides.html#modelo-lineal-generalizado-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Generalizado",
    "text": "Modelo Lineal Generalizado\n\nLineal\n\nUna transformación de la media (valor esperado de la respuesta) se relaciona linealmente con las fuentes de variación reconocidas a priori\nPredictor lineal de una función de la esperanza o media de \\(Y\\), \\(E(Y)\\)\n\nGeneralizado\n\nLa componente aleatoria puede ser no-normal (distribución miembro de la familia exponencial como es el caso de Bernouille, Binomial y Poisson para modelar presencia/ausencia, proporciones y conteos respectivamente y el caso de distribuciones continuas: Normal, Gamma, Inversa Gaussiana)"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-1",
    "href": "slides.html#modelo-lineal-mixto-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto",
    "text": "Modelo Lineal Mixto\nPermite estimar un modelo para respuestas normales sin que se cumpla el supuesto de independencia y/o de homogeneidad de varianzas\nLa respuesta se modela como función de variables explicativas de efectos fijos y de efectos aleatorios.\nLa correlación se puede abordar de dos formas:\n\nEspecificando correlaciones entre los términos de error\nIncorporando efectos aleatorios que inducen correlaciones entre los datos que comparten el mismo nivel del efecto\n\n\n\n\n\n\n\nLa correlación entre los errores se especifica como función de la distancia espacial entre las observaciones (por ej. correlación espacial exponencial o esférica como modelos para la caída de las correlaciones a medida que aumenta la distancia entre observaciones)"
  },
  {
    "objectID": "slides.html#modelo-bayesiano-1",
    "href": "slides.html#modelo-bayesiano-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Bayesiano",
    "text": "Modelo Bayesiano\n\nRelacionan la variable dependiente con variables explicativas a través de parámetros desconocidos.\nLos parámetros se interpretan en término de probabilidades bayesianas; se supone una distribución “a priori” para cada parámetro y se deriva la distribución “a posteriori” de cada parámetro.\nLa media, moda o mediana de la distribución a posteriori se usa como proxy del parámetro.\nLas “a priori” son parte del modelo y una manera de expresar la distribución de probabilidad de los datos dados los parámetros.\nLos parámetros de las distribuciones “a priori” se llaman hiperparámetros.\n“a posteriori” = actualización de la “a priori” con los datos observados.\nPermite otorgar grado de creencia (intervalo de credibilidad)"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-modelo-jerárquico-normal",
    "href": "slides.html#modelo-lineal-mixto-modelo-jerárquico-normal",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto = Modelo Jerárquico Normal",
    "text": "Modelo Lineal Mixto = Modelo Jerárquico Normal\nUn modelo jerárquico es un modelo especificado en etapas.\nEjemplo: Modelo lineal mixto con efectos aleatorios \\(u\\).\n\\[y \\vert \\beta, u, \\sigma^2 \\sim N(x' \\beta + z'u, \\sigma^2I) \\\\\nu \\sim N(0, D(\\theta))\\]"
  },
  {
    "objectID": "slides.html#frecuentista",
    "href": "slides.html#frecuentista",
    "title": "Modelos Espaciales",
    "section": "Frecuentista",
    "text": "Frecuentista\nRelacionan la variable respuesta con variables explicativas a través de parámetros desconocidos. Los parámetros son constantes que se estiman con determinada confianza."
  },
  {
    "objectID": "slides.html#bayesiano",
    "href": "slides.html#bayesiano",
    "title": "Modelos Espaciales",
    "section": "Bayesiano",
    "text": "Bayesiano\nRelacionan la variable dependiente con variables explicativas a través de parámetros desconocidos. Los parámetros se interpretan en término de probabilidades bayesianas; se supone una distribución “a priori” para cada parámetro y se deriva la distribución “a posteriori” de cada parámetro y para la predicción de Y."
  },
  {
    "objectID": "slides.html#modelo-jerárquico-normal",
    "href": "slides.html#modelo-jerárquico-normal",
    "title": "Modelos Espaciales",
    "section": "Modelo Jerárquico Normal",
    "text": "Modelo Jerárquico Normal\nSe utiliza Máxima Verosimilitud (ML) o Máxima Verosimilitud Restringida (REML).\nSe estiman los parámetros de la estructura de media (coeficientes de regresión) y los parámetros de varianza y covarianza asociados a los términos de error (varianza nugget, varianza del proceso con datos independientes y rango).\n\n\n\n\n\n\nLos errores estándares se ajustan por correlación espacial.\n\n\n\n\n\n\n\n\n\nCon muchos datos, la computación de distancias y de la verosimilitud es costosa. Se deben usar otros métodos de estimación."
  },
  {
    "objectID": "slides.html#modelo-jerárquico-bayesiano-1",
    "href": "slides.html#modelo-jerárquico-bayesiano-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Jerárquico Bayesiano",
    "text": "Modelo Jerárquico Bayesiano\nEn un modelo bayesiano, los parámetros se consideran variables aleatorias y tienen distribuciones a priori. Continuando con el ejemplo anterior:\n\\[\\beta \\sim \\pi (\\beta)\\]\nEn el modelo jerárquico bayesiano, los parámetros de las distribuciones a priori de los parámetros (llamados hiperparámetros) también se consideran variables aleatorias, y también tienen ditribuciones a priori.\n\\[\\sigma^2 \\sim \\pi (\\sigma^2)\\]"
  },
  {
    "objectID": "slides.html#modelo-gausiano-latente-una-clase-de-mjb",
    "href": "slides.html#modelo-gausiano-latente-una-clase-de-mjb",
    "title": "Modelos Espaciales",
    "section": "Modelo Gausiano Latente (una clase de MJB)",
    "text": "Modelo Gausiano Latente (una clase de MJB)\nEl predictor lineal contiene el intercepto, los efectos de las covariables y funciones desconocidas \\(f^{(k)}\\) que incluyen los efectos aleatorios:\n\\[\\eta_i = \\mu + \\sum_{j}{\\beta_j z_{ij}} + \\sum_{k}{f^{(k)}u_{ik}}\\]\nLos componentes del predictor lineal forman un campo latente \\(x=(\\eta, \\mu, \\beta, f)\\). Además de los parámetros de la verosimilitud, también habrá hiperparámetros \\(\\theta\\). En un MLG, todos los componentes del predictor lineal deben tener distribuciones a priori gausianas, pero \\(\\theta\\) puede tener distribuciones a priori no gausianas.\nEl MLG se puede escribir formalmente como:\n\\[y \\vert x, \\theta \\sim \\prod \\pi (y_i \\vert \\eta_i, \\theta) \\\\\nx \\vert \\theta \\sim N(0, Q^{-1}(\\theta)) \\\\\n\\theta \\sim \\pi(\\theta)\\]"
  },
  {
    "objectID": "slides.html#estimación-vía-inla",
    "href": "slides.html#estimación-vía-inla",
    "title": "Modelos Espaciales",
    "section": "Estimación vía INLA",
    "text": "Estimación vía INLA\nINLA es más rápido que MCMC porque el campo latente al que referencia es un campo aleatorio gaussiano de Markov (GMRF) y por tanto tiene matriz de precisión rala, lo que permite a INLA utilizar métodos numéricos para matrices ralas, que son más eficientes.\nLa estimación de INLA requiere la construcción de una grilla espacial (mesh). La grilla es una colección de elementos geométricos (trángulos) que divide el espacio dimensional que contiene los sitios con observaciones a partir de la cual se estima la dependencia espacial de la variable respuesta.\nLa estimación de las covarianzas de los efectos de sitio se hacen a través de funciones de suavizado impuestas sobre la grilla espacial. La aproximación SPDE (Stochastic Partial Differential Equation), agiliza el cómputo ya que la solución se presenta como una matriz de covarianza de Mátern.\n\n\n\n\n\n\nINLA puede ser usado para estimar modelo jerárquicos para datos espaciales con variable de respuesta normal, binaria, binomial, conteos, es decir, en el contexto de Modelos Lineales Generalizados Mixtos"
  },
  {
    "objectID": "Ej01.html#ajuste-de-mjb-con-inlabru",
    "href": "Ej01.html#ajuste-de-mjb-con-inlabru",
    "title": "Ejemplo 1: Modelación del rendimiento de caña de azúcar a partir de información satelital",
    "section": "Ajuste de MJB con inlabru",
    "text": "Ajuste de MJB con inlabru\nEl paquete inlabru fue desarrollado para facilitar la modelación espacial utilizando funciones del paquete INLA.\n\nndvi_bru_spde <-\n  bru(\n    TCH ~ Intercept(1) + ndvi + site(main = coordinates, model = spde),\n    family = \"gaussian\",\n    data = as_Spatial(datos_sf)\n  )\n\nsummary(ndvi_bru_spde)\n\n## inlabru version: 2.5.3\n## INLA version: 22.10.13\n## Components:\n##   Intercept: Model types main='linear', group='exchangeable', replicate='iid'\n##   ndvi: Model types main='linear', group='exchangeable', replicate='iid'\n##   site: Model types main='spde', group='exchangeable', replicate='iid'\n## Likelihoods:\n##   Family: 'gaussian'\n##     Data class: 'SpatialPointsDataFrame'\n##     Predictor: TCH ~ .\n## Time used:\n##     Pre = 7.98, Running = 10.1, Post = 1.05, Total = 19.2 \n## Fixed effects:\n##             mean     sd 0.025quant 0.5quant 0.975quant   mode kld\n## Intercept 31.298 16.663     -1.334   31.276     64.047 31.231   0\n## ndvi      79.801 24.893     30.758   79.881    128.397 80.043   0\n## \n## Random effects:\n##   Name     Model\n##     site SPDE2 model\n## \n## Model hyperparameters:\n##                                             mean       sd 0.025quant 0.5quant\n## Precision for the Gaussian observations    0.011    0.005      0.005    0.011\n## Range for site                          6827.928 3239.781   2608.525 6146.314\n## Stdev for site                            16.247    3.602     10.216   15.895\n##                                         0.975quant     mode\n## Precision for the Gaussian observations   2.30e-02    0.009\n## Range for site                            1.51e+04 5005.853\n## Stdev for site                            2.43e+01   15.241\n## \n## Deviance Information Criterion (DIC) ...............: 615.48\n## Deviance Information Criterion (DIC, saturated) ....: 14385.92\n## Effective number of parameters .....................: 37.10\n## \n## Watanabe-Akaike information criterion (WAIC) ...: 620.13\n## Effective number of parameters .................: 32.96\n## \n## Marginal log-Likelihood:  -346.58 \n##  is computed \n## Posterior summaries for the linear predictor and the fitted values are computed\n## (Posterior marginals needs also 'control.compute=list(return.marginals.predictor=TRUE)')\n\n\n\nplot(ndvi_bru_spde, \"Intercept\")\nplot(ndvi_bru_spde, \"ndvi\")\n\n\n\n\n\n\n\n\n\n\n\n\nDistribución a posteriori de los hiperparámetros\n\n\nspde.posterior(ndvi_bru_spde, \"site\", what = \"matern.covariance\") -> covplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"matern.correlation\") -> corplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"range\") -> rngplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"log.range\") -> lgrngplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"variance\") -> varplot\nspde.posterior(ndvi_bru_spde, \"site\", what = \"log.variance\") -> lgvarplot\n\nmultiplot(plot(covplot), plot(corplot),\n          plot(rngplot), plot(lgrngplot),\n          plot(varplot), plot(lgvarplot))\n\n\n\n\n\nObservados vs. distribución a posteriori\n\npred_mesh <-\n  predict(ndvi_bru_spde, as_Spatial(datos_sf), ~ Intercept + ndvi + site)\npredichos <- st_as_sf(pred_mesh)\n\nggplot(predichos, aes(mean, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\n\n\n\n\n\n\nPredicción espacial de TCH\n## code-block-border-left: \"#b50018\"\n\n# No aplica para esta aplicación.\n# pred_mesh <-\n#   predict(ndvi_bru_spde, pixels(mesh), ~ Intercept + ndvi + site)\n# \n# ggplot() +\n#   gg(pred_mesh)\n# ggplot(datos_sf) +\n#   gg(pred_mesh) +\n#   gg(mesh) +\n#   geom_sf()\n\n\n\npredichos_lm$pred_ndvi_inla <- predichos$mean\n\nggplot(predichos_lm, aes(pred_ndvi_iid, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\n\n\n\nggplot(predichos_lm, aes(pred_ndvi_esp, TCH)) +\n  geom_point() +\n  geom_abline(slope = 1, intercept = 0)\n\n\n\nggplot() +\n  geom_point(data = predichos_lm, \n             aes(pred_ndvi_iid, TCH, color = 'REML iid')) +\n  geom_point(data = predichos_lm, \n             aes(pred_ndvi_esp, TCH, color = 'REML Corr')) +\n  geom_point(data = predichos_lm, \n             aes(pred_ndvi_inla, TCH, color = 'INLA Corr')) +\n  geom_abline(slope = 1, intercept = 0) +\n  labs(x = 'TCH Predichos', y = 'TCH Observado', color = 'Estimación')"
  },
  {
    "objectID": "slides.html#ejemplo-mjb-datos-de-conteo",
    "href": "slides.html#ejemplo-mjb-datos-de-conteo",
    "title": "Modelos Espaciales",
    "section": "Ejemplo MJB datos de conteo",
    "text": "Ejemplo MJB datos de conteo\n\\[Y_i \\sim Poisson(\\theta_i) \\ \\ \\ \\ i = 1, \\dots, n\\]\n\\[log(\\theta_i) = \\beta_0 + \\beta_1 \\times x_i + \\dots + u_i + \\nu_i\\]\n\\[u_i \\vert u_{-i} \\sim N \\Bigg( \\bar{u}_{\\delta_i}, \\frac{\\sigma_{u}^{2}}{\\eta_{\\delta_i}} \\Bigg) \\]\n\\[\\nu \\sim N(0,\\sigma_{\\nu}^2)\\] Tasa estandarizada de incidencia (SIR) \\[SIR_i = \\frac{Y_i}{E_i}\\]\n\n\n\n\n\n\nRiesgo Relativo (RR) con datos espaciales\n\n\nRelación entre la probabilidad de que ocurra el evento en el sitio y la probabilidad de que el mismo evento ocurra en otro sitio."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nSe tiene una respuesta continua ESPI (Ecosystem Services Provisioning Index) observada en el territorio de la Cuenca del Carcarañá. El territorio está dividido en 4676 unidades de área de 1400 Has. cada una. Se dispone además de la covariable “Porcentaje de Pasturas Naturales Manejadas” en cada unidad de área.\n\n\n\n\n\nMapa de ESPI observado\n\n\n\n\n\n\n\n\n\nRegión\nESPI\n%PasturaNaturalManejada\n\n\n\n\n1\n2.11\n1.90\n\n\n2\n1.35\n0.20\n\n\n3\n1.84\n19.33\n\n\n4\n2.04\n60.08\n\n\n…\n…\n…\n\n\n4676\n2.13\n62.57\n\n\n\n\n\n\n\nMin: 0.088\nMedia: 1.84\nDE: 0.287\nMax: 3"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-1",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nVamos a modelar el ESPI en función del porcentaje de pasturas en cada región \\(i\\) utilizando una regresión lineal bayesiana con efectos aleatorios de sitio iid\n\\[y_i \\sim N \\big(\\mu, \\tau_{\\varepsilon}^{-1} \\big)\\]\n\\[E \\left[ y_i \\right] = \\beta_0 + \\beta_1 \\times Porc.Pasturas_i + \\mu_i\\]\n\\[u_i \\sim i.i.d \\ N \\big(0, \\tau_{u}^{-1} \\big)\\]\nEn la regresión bayesiana, los parámetros \\(\\beta_0\\) y \\(\\beta_1\\) tienen distribuciones a priori y en el jerárquico bayesiano, los hiperparámetros \\(\\tau_{\\varepsilon}^{-1}\\) y \\(\\tau_{\\mu}^{-1}\\) también.\nPor defecto, INLA asigna distribuciones a priori no informativas \\(N(0, 10e^5)\\) para \\(\\beta_0\\) y \\(\\beta_1\\), y \\(Gamma(0, 10e^5)\\) para \\(\\tau_{\\varepsilon}^{-1}\\) y \\(\\tau_{u}^{-1}\\)\n\n\n\n\n\n\nComo sólo se tiene un nivel de observaciones y la respuesta es gaussiana, agregar efectos iid solo equivale a redistribuir la varianza entre el efecto aleatorio y el error de las observaciones."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-2",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-2",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nCorremos el modelo en INLA:\n\nm1 <- inla(\n  formula = ESPI ~ porcentaje_pasturas + f(id_region, model = 'iid'),\n  family = 'gaussian',\n  data = data,\n  control.compute = list(dic = TRUE, waic = TRUE),\n)\n\nAl efecto aleatorio iid lo incluimos en la fórmula con f(id_region, model = 'iid').\nCon control.compute le pedimos a INLA que calcule los criterios de información DIC y WAIC (menores = mejores)."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-3",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-3",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nDistribuciones a posteriori de los coeficientes de regresión:"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-4",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-4",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nDistribuciones a posteriori para los hiperparámetros (escala de precisión \\(\\tau\\))\n\n\n\nGráfico en la escala de la desviación estándar \\(\\sigma\\)\n\\[\\sigma^2 = \\frac{1}{\\tau}\\]"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-5",
    "href": "slides.html#modelo-lineal-mixto-iid-para-látice-estimado-vía-inla-5",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto iid para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto iid para látice estimado vía INLA\nGráficos con los predichos y las observaciones, calculando el predicho puntual como la moda de la distribución a posteriori de los predichos:\n\nDIC: 88 | WAIC: -43\n\n\n\n\n\n\nPredichos puntuales\n\n\n\n\n\n\nObservaciones"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nEn vez de utilizar efectos aleatorios normales e idéndticamente distribuídos, podríamos utilizar efectos aleatorios con estructura espacial explícita.\nUn ejemplo clásico apra datos areales son los efectos con estructura Intrinsic Conditional Autoregressive o ICAR (Besag, 1974):\n\\[u_i \\vert u_{-1} \\sim N \\Big( \\frac{1}{N_1} \\sum_{j=1}^{n} a_{ij} u_j, \\frac{1}{\\tau_u N_i} \\Big)\\]\ndonde \\(a_{ij} \\ne 0\\) si y solo si las áreas \\(i\\) y \\(j\\) son vecinas, \\(N_i\\) es la cantidad de áreas vecinas del área \\(i\\), \\(u_{-1}\\) se asume \\(\\sum_{j=1}^{n} u_i = 0\\)\nHay distintas maneras de definir cuándo dos áreas son vecinas y qué peso tomará \\(a_{ij}\\) cuando lo son. Por ejemplo, podríamos tomar que son vecinas cuando se tocan al menos en un punto, y que \\(a_{ij} = 1\\) cuando son vecinas."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-1",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-1",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nVamos a modelar el ESPI en función del porcentaje de pasturas en cada región \\(i\\) utilizando una regresión lineal bayesiana con efectos aleatorios espaciales ICAR:\n\\[y_i \\sim N \\big(\\mu, \\sigma_{\\varepsilon}^{-2} \\big)\\]\n\\[E \\left[ y_i \\right] = \\beta_0 + \\beta_1 \\times Porc.Pasturas_i + \\mu_i\\]\n\\[u_i \\vert u_{-1} \\sim N \\Big( \\frac{1}{N_1} \\sum_{j=1}^{n} a_{ij} u_j, \\frac{1}{\\tau_u N_i} \\Big)\\]"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-2",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-2",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nDefinimos un grafo con los vecindarios de cada región:\n\nadj <- poly2nb(data)\nvecindario <- nb2mat(adj, style = \"W\", zero.policy = TRUE) \n\nCorremos el modelo en INLA:\n\nm2 <- inla(\n  formula = ESPI ~ porcentaje_pasturas + f(id_region, model = 'icar',\n                                           graph = vecindario),\n  family = 'gaussian',\n  data = data,\n  control.compute = list(dic = TRUE, waic = TRUE),\n)\n\nLe pasamos el grafo al modelo en f(…, graph = vecindario)."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-3",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-3",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nDistribuciones a posteriori de los coeficientes de regresión:"
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-4",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-4",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nDistribuciones a posteriori para los hiperparámetros (escala de precisión \\(\\tau\\))\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nEl desvio estandar del efecto aleatorio podría tener mayor magnitud que el desvío estándar del ESPI observado, que era 0.287."
  },
  {
    "objectID": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-5",
    "href": "slides.html#modelo-lineal-mixto-icar-para-látice-estimado-vía-inla-5",
    "title": "Modelos Espaciales",
    "section": "Modelo Lineal Mixto ICAR para látice estimado vía INLA",
    "text": "Modelo Lineal Mixto ICAR para látice estimado vía INLA\nGráficos con los predichos y las observaciones, calculando el predicho puntual como la moda de la distribución a posteriori de los predichos:\n\nDIC: -3783 | WAIC: -3862\n\n\n\n\n\n\nPredichos puntuales\n\n\n\n\n\n\nObservaciones"
  },
  {
    "objectID": "slides.html#comentarios",
    "href": "slides.html#comentarios",
    "title": "Modelos Espaciales",
    "section": "Comentarios",
    "text": "Comentarios\nEntre estos ajustes, el modelo ICAR proporcionó menores DIC y WAIC. Ademas, en los mapas de predichos se observa que el ICAR logra captar el detalle de las regiones con ESPI bajo, algo que el iid no logró.\nEn un modelo con efecto aleatorio de sitio y efecto aleatorio residual separables podrían usarse distintos modelos para los distintos efectos aleatorios. Por ejemplo ICAR para el efecto sitio e i.i.d para el residual"
  }
]